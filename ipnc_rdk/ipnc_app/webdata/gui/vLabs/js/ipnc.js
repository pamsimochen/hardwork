if($.browser.msie){if(("console" in self)&&("log" in console)){console.error=console.log;console.warn=console.log}else{var dummy=function(){};console={error:dummy,warn:dummy,log:dummy}}}function logInternal(c,b){var a=$.makeArray(arguments).slice(2);if(IPNC.logLevel>=c){if($.browser.msie){if(("console" in self)&&("log" in console)){console.log(a)}}else{b.apply(console,a)}}}var logError=curry(logInternal,0,console.error);var logWarn=curry(logInternal,1,console.warn);var logInfo=curry(logInternal,2,console.log);var logDebug=curry(logInternal,3,console.log);function parseINI(c){var a=c.split(/<br>/g);var b={};$.each(a,function(f,e){var g=null;if(e.length>0){g=e.split(/[=]/);var d=g[0];var h=g[1];if($.isNumeric(h)&&d!=="motionblock"&&d!=="smtpip"&&d!=="ftpip"&&d!=="ftpuser"){h=parseDecimal(h)}b[d]=h}});return b}function getIndexFromCombo(a){return $("#"+a).get(0).selectedIndex}function updateFromCombo(b,a,c){logDebug("Updating from combo:",c,"to",a);b[a]=getIndexFromCombo(c)}function updateFromInput(c,b,d){var a=$("#"+d).val();if($.isNumeric(a)&&!(b==="smtpip"||b==="ftpip"||b==="ftpuser")){a=parseDecimal(a)}logDebug("Updating from input:",d,"to",b,"new value:",a);c[b]=a}function updateFromInputHandleEmpty(c,b,d){var a=$("#"+d).val();if(a.length===0){a=0}else{if($.isNumeric(a)&&!(b==="smtpip"||b==="ftpip")){a=parseDecimal(a)}}logDebug("Updating from input:",d,"to",b,"new value:",a);c[b]=a}function mkNavBar(){var e=[];var a=IPNC.userSettings;if(a){e.unshift({title:"Camera Settings",active:true})}else{e.unshift({title:"Login",active:true})}var b=$("#navbar-container").empty().append(mkElem("a",{href:"#","class":"brand"},"IPNC")).append(mkNavList(false,"nav",e));if(a){var f=IPNC.userSettings.users[IPNC.userSettings.currUser];var c=IPNC.userSettings.authorityNames[f.authority];var d=f.authority===IPNC.userSettings.authorityadmin;b.append(mkElemClass("div","pull-right",[mkElemClass("button","btn btn-primary btn_large","logout").click(function(){function g(){IPNC.userSettings=false;timerManager.clear();if(getCookie("rememberpassword")==="true"){prepareLogin()}else{logDebug("reloading");setCookies("userName"," ");setCookies("passWord"," ");window.location.reload()}}if(false){$.ajax({url:IPNC.serverURL+"ini.htm",username:"$$$",password:"$$$",success:function(){logDebug("Unexpected success");g()},error:function(){logDebug("Expected error happened.");g()}})}else{g()}})]))}b.append(mkElem("div",{id:"divStatus","class":"pull-right"}));if(a){$(".dropdown-toggle").dropdown()}}var navigatorObj={};function postLogin(c){IPNC.userName=$("#inputUserName").val();IPNC.userPassword=$("#inputPassword").val();if(getCookie("rememberpassword")){setCookies("userName",$("#inputUserName").val());setCookies("passWord",$("#inputPassword").val())}IPNC.userSettings=initUserSettings(parseINI(c));mkNavBar();$("body").removeClass("loginScreen").addClass("mainScreen");$("#container").html('      <div class="row-fluid">         <div id="sidebar" class="span3"></div>         <div id="mainbar" class="span9 well"></div>       </div>');function b(f){$("#mainbar").html(mkElem("div",{},[mkElem("h2",{},f),mkElemClass("div","alert alert-info span3","This page is under construction!")]))}var e=IPNC.userSettings.users[IPNC.userSettings.currUser].authority;var a=e===IPNC.userSettings.authorityadmin;var d=a||e===IPNC.userSettings.authorityoperator;navigatorObj=mkNavigator([{title:"Live View",icon:"icon-ipnc-live",click:openLiveView,active:true},a?{title:"Add / Edit Users",icon:"icon-ipnc-user",click:openAddEditUsers}:null,d?{title:"Settings",icon:"icon-ipnc-settings",children:[{title:"Video",click:openVideo,close:closeVideo,id:"menuVideo"},{title:"Advanced Features",click:openAdvFeatures,close:closeAdvFeature},{title:"Smart Analytics",click:openSmartAnalytics,hidden:true,id:"menuSmartAnalytics"},{title:"Camera",click:openCamera,close:closeCamera},{title:"Audio",click:openAudio,close:closeAudio},{title:"Date / Time",click:openDateTime,close:closeDateTime},{title:"Network and Port",click:openNetWorkAndPort,close:closeNetwork},{title:"Alarm",click:openAlarm,close:closeAlarm},{title:"Storage",click:openStorage,close:closeStorage}]}:null,d?{title:"Maintenance",icon:"icon-ipnc-maint",click:openMaintenance}:null,d?{title:"Support",icon:"icon-ipnc-support",click:openSupport}:null],function(){timerManager.clear()});$("#sidebar").html(navigatorObj.elem);openLiveView()}function mkLabel(a,c){var b="label"+(c?" label-"+c:"");return mkElemClass("span",b,a)}function startLogin(){var b=$("#inputUserName").val(),a=$("#inputPassword").val();if(b.length>0){if(a.length>0){$.ajax({url:IPNC.serverURL+"ini.htm",username:b,password:a,timeout:10*1000,success:postLogin,error:function(){showMessageModal("Message","Login Failed")}})}else{showMessageModal("Message","Enter Password")}}else{showMessageModal("Message","Enter User Name")}return false}function mkLoginForm(){var b=mkElemClass("div","form-actions",mkButton("Login","btn-primary").click(startLogin));var a=mkElemClass("div","formBkgWrapper",mkElemClass("form","form-horizontal well loginForm",mkElemClass("fieldset",null,[mkPrependedInput("Username",{id:"inputUserName","class":"input-medium",maxlength:"32"},"icon-user"),mkPrependedInput("Password",{id:"inputPassword",type:"password","class":"input-medium",maxlength:"16"},"icon-lock"),mkCheckButton("Remember password","inputRemember",{change:function(c){setCookies("rememberpassword",c)}}),b])));$("body").removeClass("mainScreen").addClass("loginScreen");return mkElemClass("div","",centerWrap(a))}function modalProgress(a,d){var b=0;c();function c(){b+=1;updateProgressBar("#updateProgress",b/a);if(b<a){setTimeout(c,1000)}else{d()}}}function checkReload(a){logDebug("Checking for reload flag from Camera.");$.ajax({url:IPNC.serverURL+"vb.htm",data:{paratest:"reloadflag"},success:function(d){var b=parseVBResponse(d);var c=b.reloadflag==="1";logInfo("Camera says reload required:",c);if(c){$.ajax({url:IPNC.serverURL+"ini.htm",success:function(h){var g=parseINI(h);var f=parseDecimal(g.reloadtime);logDebug("Reload time:",f);var e=f+IPNC.reloadTimeBuffer;logDebug("Total Reload time:",e);a(c,e)}})}else{a(c)}}})}function splitOnce(a,b){var c=a.split(b);return[c.shift(),c.join(b)]}function parseVBResponse(c){var b=c.split(/\n/g);var a={parseErrorsFound:false};$.each(b,function(g,e){var d=splitOnce(e," ");if(d[0]==="OK"){var f=d[1].split(/[=]/);if(f.length==2){a[f[0]]=f[1]}else{if(f.length==1){a[f[0]]=true}else{a[d[1]]=true}}}else{if(e.length>0){var h=d[1];if(h!=="_"){logWarn("camera said Not OK for parameter:",h);logWarn("full camera response was",e);a.parseErrorsFound=true}}}});return a}function parseVBStatusResponse(c){var b=c.split(/\n/g);var a={};$.each(b,function(g,e){var h=e.indexOf(" ");if(h>=0){var d=e.slice(0,h);if(d==="OK"){var j=e.slice(h+1);var f=j.split(/[=]/);if(f.length==2){a[f[0]]=$.trim(f[1])}}else{if(e.length>0){var k=e.slice(3);if(k!=="_"){logWarn("camera said Not OK for parameter:",k);logWarn("full camera response was",e)}}}}});return a}function mkModal(g,c,e,b,f,a,d){return mkElem("div",{id:g,"class":"modal hide "+c},[mkElemClass("div","modal-header",[a?mkElem("button",{type:"button","class":"btn close","data-dismiss":"modal"},"×").click(d):null,mkElem("h3",{},e)]),mkElemClass("div","modal-body",mkElem("p",{},b)),mkElemClass("div","modal-footer",f)])}var standardModalOptions={backdrop:"static",keyboard:false};function mkModalElem(a,e,g,f,h,i,c,b){var d=mkElem("div",{id:a,"class":"modal hide "+e},[mkElemClass("div","modal-header",[c?mkElem("button",{type:"button","class":"btn close","data-dismiss":"modal"},"×").click(b):null,mkElem("h3",{},g)]),mkElemClass("div","modal-body",mkElem("p",{},f)),mkElemClass("div","modal-footer",h)]);$(d).modal(i);return d}function showMessageModal(c,a,b){return mkModalElem("msgModal","",c,a,mkElem("button",{type:"button","class":"btn btn-primary","data-dismiss":"modal"},"Ok").click(b),standardModalOptions,true,b)}function showOverlaidMessageModal(c,a,b){videoManager.hideAll();showMessageModal(c,a,function(){videoManager.showAll();if(b){b()}})}function showConfirmationModal(g,a,d,c,b){var f=b?"btn-danger":"btn-primary";var e=mkModal("confirmModal","",g,a,[mkElem("button",{type:"button","class":"btn "+f,"data-dismiss":"modal"},"Yes").click(d),mkElem("button",{type:"button","class":"btn","data-dismiss":"modal"},"No").click(c)],true,c);$(e).modal(standardModalOptions)}function showOverlaidConfirmationModal(e,a,d,c,b){videoManager.hideAll();showConfirmationModal(e,a,function(){videoManager.showAll();if(d){d()}},function(){videoManager.showAll();if(c){c()}},b)}function mkUpdateModal(){return mkModal("updateModal","","Updating Camera Settings...",mkProgressBar("updateProgress"),"[ Please wait ]")}function sendSettings(a,c,b){var d={};$.each($.makeArray(c),function(f,e){if(a.hasOwnProperty(e)){d[e]=a[e]}else{logError("Not found setting",e)}});$.ajax({url:IPNC.serverURL+"vb.htm",data:d,success:function(f){var e=parseVBResponse(f);logDebug("vb response",e);b(e)}})}function initUserSettings(c){var g=c.authority.split(/\n/g);var d=[];var e=-1;$.each(g,function(l,m){var j=m.split(/:/g);var k=parseDecimal(j[0].slice(9))-1;var n=parseDecimal(j[1]);if(n!==9){d[k]=n}});var a=c.user.split(/\n/g);var h=[];$.each(a,function(m,n){if(n.length>0){var j=n.split(/:/g);var l=j[1];var k=parseDecimal(j[0].slice(4))-1;if(j.length>1&&j[1].length>0&&d[k]!==undefined){if(l===IPNC.userName){e=k}h[k]={name:l,authority:d[k]}}}});var f=[];f[c.authorityadmin]="Administrator";f[c.authorityoperator]="Operator";f[c.authorityviewer]="Viewer";var b={};$.each(["authorityadmin","authorityoperator","authorityviewer"],function(k,j){b[j]=parseDecimal(c[j])});return $.extend(c,b,{users:h,authorityNames:f,currUser:e})}function ajaxChain(a,b,e,d){if(!e){e=0}if(e<a.length){var c=a[e];logDebug("fetching link",e,c.url);$.ajax({url:c.url,dataType:"text",async:b,success:function(f){if(c.callback){c.callback(f)}ajaxChain(a,b,e+1,d)}})}else{if($.isFunction(d)){logDebug("Calling final callback");d()}}}function mkSampleRateInt(b){var c=parseDecimal(b);var a=b.indexOf("hz")-1;var d=b[a];var e=1;if(d==="K"){e=1000}else{if(d==="M"){e=1000*1000}}return c*e}function mkAudioEncodeParams(c){var j=c.encodingname.split(/;/);var g=j[c.encoding];var h=0;var d=c.audiobitratename.split(/;/);var a=d[c.audiobitrate];var b=c.sampleratename.split(/;/);var i=mkSampleRateInt(b[c.samplerate]);var f=1;var e=c.audioinvolume;return[g,h,a,i,f,e].join(";")}function addVideoDiv(d,h,c,a,b,f){var g=b?b:"video";var e=null;if($.browser.msie){e='<div class="videoContainer" style="width:'+c+"px !important; height:"+a+'px !important;" >                   <object class="videoObj" classid="'+IPNC.pluginIdMSIE+'" width="'+c+'px" height="'+a+'px" id="'+g+'" events="True">                     <param name="ShowDisplay" value="True" ></param>                     <param name="AutoLoop" value="no"></param>                     <param name="AutoPlay" value="no"></param>                   </object>               </div>'}else{e='<div class="videoContainer" style="width:'+c+"px !important; height:"+a+'px !important;"> <embed class="videoObj" type="'+IPNC.pluginId+'" pluginspage="http://www.videolan.org"                     version="VideoLAN.VLCPlugin.2" width="'+c+'" height="'+a+'" id="'+g+'" toolbar="false"> </embed>                 </div>'}$(h).html(e);$(".videoObj",$(h)).css({width:c,height:a});if(IPNC.pluginNeedsDims){videoManager.setProperty("winWidth",c,g);videoManager.setProperty("winHeight",a,g)}if(!f){videoManager.setProperty("audioEncodeParams",mkAudioEncodeParams(d),g)}}var videoManager=function Video(){function c(d){return $(d?("#"+d):".videoContainer .videoObj")}this.getVideoObj=c;this.setProperty=function(e,f,d){c(d).each(function(h,g){if(g&&g.tiipnc){logDebug("Setting property",e,"to",f," for video id:",d);g.tiipnc[e]=f}})};this.getProperty=function(f,e){var d=null;c(e).each(function(h,g){if(g&&g.tiipnc){d=g.tiipnc[f];logDebug("Read property",f,"=",d)}});return d};this.play=function(e,d){if(IPNC.debugStreams){logDebug("Changed play url. Original:",e);e=IPNC.debugStreams[0]}if(d){logDebug("For video id",d)}logDebug("about to play",e);c(d).each(function(g,f){if(f){if(f.playlist){f.playlist.items.clear();f.playlist.playItem(f.playlist.add(e))}}})};this.playItem=function(e,d){logDebug("about to play item:",e);c(d).each(function(g,f){if(f){if(f.playlist){f.playlist.playItem(e)}}})};this.replay=function(d){logDebug("about to replay");c(d).each(function(f,e){if(e){if(e.playlist){e.playlist.stop();e.playlist.play()}}})};this.playAll=function(f,e){if(IPNC.debugStreams){newurls=[];while(newurls.length<f.length){newurls=newurls.concat(IPNC.debugStreams.slice(0,f.length-newurls.length))}f=newurls}logDebug("about to play all",f);var d=[];c(e).each(function(h,g){if(g){if(g.playlist){g.playlist.stop();g.playlist.items.clear();$.each(f,function(j,k){var l=g.playlist.add(k);d.push(l)});logDebug("items",g.playlist.items.count);g.playlist.play()}}});return d};this.stop=function(d){c(d).each(function(f,e){if(e){if(e.playlist){e.playlist.stop();e.playlist.items.clear()}}})};this.stopNoClear=function(d){c(d).each(function(f,e){if(e){if(e.playlist){e.playlist.stop()}}})};this.stopAndHide=function(d){this.stop(d);c(d).css("visibility","hidden")};function a(d){c(d).css("visibility","hidden")}this.hide=a;this.hideAll=function(){a()};function b(d){c(d).css("visibility","visible")}this.show=b;this.showAll=function(){b()};this.registerVLCEvent=function(e,d){c().each(function(f,g){if(g.attachEvent){g.attachEvent(e,d)}else{if(g.addEventListener){g.addEventListener(e,d,false)}else{g["on"+e]=d}}})};this.unregisterVLCEvent=function(e,d){c().each(function(f,g){if(g.detachEvent){g.detachEvent(e,d)}else{if(g.removeEventListener){g.removeEventListener(e,d,false)}else{g["on"+e]=null}}})};this.togglePause=function(d){c(d).each(function(f,e){if(e){if(e.playlist){e.playlist.togglePause()}}})};return this}();function mkSaveStatusDiv(){return mkElem("div",{id:"saveStatusMsg"})}var pendingStatus=null;function mkVerboseSaver(a,c,b){return curry(a,function(){pendingStatus=$.isFunction(c)?c():c;if(b){b()}})}function showPendingStatus(){if(pendingStatus){$("#saveStatusMsg").html(mkElem("p",{},pendingStatus));setTimeout(function(){$("#saveStatusMsg").fadeOut(600,function(){$(this).empty()})},4*1000)}pendingStatus=null}var timerManager=function(){var b=[];this.createIntervalTimer=function(f,e){this.registerIntervalTimer(setInterval(f,e))};var a=0;var c=[];this.createSeqIntervalTimer=function(g,e){var f=a++;logDebug("Registering seq timer: "+f);c.push(f);d(f,g,e)};this.createSeqIntervalTimerCallImmediate=function(f,e){f();createSeqIntervalTimer(f,e)};function d(h,g,e){setTimeout(function(){if(exists(c,function(f,j){return j===h})){if(g&&typeof(g)=="function"){g()}d(h,g,e)}},e)}this.registerIntervalTimer=function(e){logDebug("Registering timer: "+e);b.push(e)};this.clear=function(){$.each(b,function(e,f){logDebug("Clearing timer: ",f);clearInterval(f)});b=[];if(c.length>0){logDebug("Clearing seq timers: ",c);c=[]}};return this}();function setCookies(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+d+a+"; path=/"}function getCookie(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null}function prepareLogin(){videoManager.stop();mkNavBar();$("#divStatus").html(mkLabel("Version "+IPNC.guiVersion,"info"));$("#container").html(mkElemClass("div","bkgWrapper",mkLoginForm()));$("#inputUserName").focus();$.each(["#inputUserName","#inputPassword"],function(a,b){validateAlphaNumericField(b)});if(getCookie("rememberpassword")==="true"){$("#inputUserName").val(getCookie("userName"));$("#inputPassword").val(getCookie("passWord"));$("#inputRemember").attr("checked","checked")}else{if(IPNC.logLevel==3&&IPNC.debugUserCreds){logWarn("Remove username, password when in production.");$("#inputUserName").val(IPNC.debugUserCreds.name);$("#inputPassword").val(IPNC.debugUserCreds.password)}}}function isPluginInstalled(){return !(videoManager.getProperty("version","dummy"))}function pollForPluginInstallation(){if(isPluginInstalled()){setTimeout(pollForPluginInstallation,100)}else{IPNC.pluginVersion=videoManager.getProperty("version");$("#dummyPlugin").remove();prepareLogin()}}$(document).ready(function(){$.ajaxSetup({cache:false,timeout:60*1000});if(IPNC.showAjaxStatus){$(document).ajaxSuccess(function(){$("#divStatus").html(mkLabel("Ajax success"));setTimeout(function(){$("#divStatus").empty()},2000)}).ajaxError(function(){$("#divStatus").html(mkLabel("Ajax error","important"))}).ajaxSend(function(c,b,a){logDebug("sending ajax",a.url);$("#divStatus").html(mkLabel("Ajax sending","info"))})}addVideoDiv(null,"#dummyPlugin",0,0,"dummy",true);pollForPluginInstallation()});function playFirstStream(a){videoManager.play(videoSettings.getStreamUrl(0),a)}function delayedExec(a,b){setTimeout(function(){logDebug("Executed after delay:",b?b:"msg empty.");if(a&&typeof(a)=="function"){a()}},10)}function hideSideBar(){$("#sidebar").hide();$("#mainbar").removeClass("span9 mainBar");$("#sideBar").removeClass("sideBar")}function showSideBar(){$("#sidebar").show();$("#mainbar").addClass("span9");$("#mainbar").addClass("mainBar");$("#sidebar").addClass("sideBar")}function getMainBarAvailableSpace(d,c){var b=(d&&d.x)||0;var a=(d&&d.y)||0;return{width:$("#mainbar").width()*c-b,height:Math.max($(window).height()*c,$("#mainbar").height()*c)-a}}function getMainBarHalfAvailableSpace(a){return getMainBarAvailableSpace(a,0.5)}function getPluginWidthAndHeight(g,c,h){function b(j,i){logDebug("Finding GCD of ",j,i);if(isNaN(j)||isNaN(i)){logError("Rcvd non numeric input",j,i);return 1}else{if(j===0&&i===0){return 1}else{if(i===0){return j}}}return b(i,j%i)}function f(){if(!$.isNumeric(h)){h=1}var j=getStreamSize(g,h);var l=j.width;var i=j.height;var k=b(l,i);return{xRatio:l/k,yRatio:i/k}}function e(m,i,k,j){logDebug("avl width x height = ",m,i);if(k===0){k=1}if(j===0){j=1}var l=i*(k/j);if(l>m){i=parseDecimal(m*(j/k))}else{m=l}return{width:Math.floor(m/16)*16,height:Math.floor(i/16)*16}}var a=f();var d=e(c.width,c.height,a.xRatio,a.yRatio);return d}function workInProgress(){return[mkSpace(),mkElemClass("span","label label-important","Work in progress").tooltip({title:"This screen is under development."})]};