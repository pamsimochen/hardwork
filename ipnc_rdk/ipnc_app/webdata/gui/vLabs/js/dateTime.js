var origDateTimeSettings={};var dateTimeSettings={};var dateTimeSettingsCount=-1;function checkDaylight(){$("#labelDayLight").text(dateTimeSettings.daylight?"Day light saving time is active":" ")}function dateToCamera(e,c){var b=$.map(c.split(/\//g),function(g){return parseDecimal(g)});var a=[[0,1,2],[2,0,1],[2,1,0]];var d=$.map(a[e],function(f){return b[f]});return d.join("/")}function saveDateTimeSettings(b){var a=["dateformat","tstampformat","dateposition","timeposition"];if(dateTimeSettingsCount===0){dateTimeSettings.newdate=dateToCamera(dateTimeSettings.dateformat,$("#dateManualId").val());dateTimeSettings.newtime=$("#selectTimeHr").val()+":"+$("#selectTimeMin").val()+":"+$("#selectTimeSec").val();a.push("newdate");a.push("newtime")}if(dateTimeSettingsCount===1){dateTimeSettings.newdate=dateToCamera(dateTimeSettings.dateformat,$("#dateCompId").val());dateTimeSettings.newtime=$("#timeCompId").val();a.push("newdate");a.push("newtime")}if(dateTimeSettingsCount===2){dateTimeSettings.timefrequency=-1;a.push("timefrequency");a.push("daylight");a.push("timezone")}sendSettings(dateTimeSettings,a,function(){checkReload(function(c){if(c){$("#updateModal").modal({backdrop:"static",keyboard:false});new modalProgress(dateTimeSettings.reloadtime,function(){$("#updateModal").modal("hide");delayedExec(b)})}else{delayedExec(b)}})})}function paddingZero(a){return(a<10?"0":"")+a}function openDateTime(){timerManager.clear();function b(){return mkElem("br",{})}function f(){return c(new Date())}function c(g){return $.extend(g,{dateFormat:function(){var h=this.getDate(),j=this.getMonth()+1,i=this.getFullYear();return[[i,j,h].join("/"),[j,h,i].join("/"),[h,j,i].join("/")]},timeFormat:function(){var h=paddingZero(this.getHours()),i=paddingZero(this.getMinutes()),j=paddingZero(this.getSeconds());return[h,i,j].join(":")},incrementSeconds:function(){this.setSeconds(this.getSeconds()+1)}})}function e(g){var h;var j=[];for(h=0;h<g;h++){j[h]=paddingZero(h)}return j}function a(){var p=f();logDebug("dateformat testing1");var g=e(60);var s=e(24);var h=mkInlineInput({id:"dateCompId",value:p.dateFormat()[dateTimeSettings.dateformat],"class":"input-small",label:"Date ",disabled:"disabled"});var m=mkInlineInput({id:"timeCompId","class":"input-small",label:"Time ",disabled:"disabled"});var k=mkInlineInput({id:"dateManualId",value:p.dateFormat()[dateTimeSettings.dateformat],"class":"input-small",label:"Date ",disabled:dateTimeSettingsCount!==0});var t=mkInlineSelectionInput("Time ","selectTimeHr",s,{selectClass:"input-mini",help:"hr",selectedIndex:p.getHours(),disabled:dateTimeSettingsCount!==0});var n=mkInlineSelectionInput(": ","selectTimeMin",g,{selectClass:"input-mini",help:"min",selectedIndex:p.getMinutes(),disabled:dateTimeSettingsCount!==0});var r=mkInlineSelectionInput(": ","selectTimeSec",g,{selectClass:"input-mini",help:"sec",selectedIndex:p.getSeconds(),disabled:dateTimeSettingsCount!==0});var l=mkInlineRadioButtonElem("Set Manualy ","setManualy","radioGroupTime",{checked:dateTimeSettingsCount===0});var o=mkRadioButtonElem("Synchronize with computer time ","syncCompId","radioGroupTime",{checked:dateTimeSettingsCount===1});var j=mkRadioButtonElem("Synchronize with SNTP server ","syncServId","radioGroupTime",{checked:dateTimeSettingsCount===2});var i=mkInlineInput({id:"sntpServ",label:"SNTP Server  ",value:dateTimeSettings.sntpip,disabled:"disabled"});var q=mkInlineSelectionInput("Time Zone  ","selectTimeZone",dateTimeSettings.timeZones,{selectedIndex:dateTimeSettings.timezone,change:curry(updateFromCombo,dateTimeSettings,"timezone","selectTimeZone"),disabled:dateTimeSettingsCount!==2});return[l,b(),k,t,n,r,b(),o,b(),h,m,b(),j,b(),i,b(),q]}function d(g){var h={newdate:"",newtime:"",index:1};return $.extend({},g,h,{datetimepositions:g.datetimepositionname.split(/;/g),dateformats:g.dateformatname.split(/;/g),timeformats:g.tstampformatname.split(/;/g)})}$.ajax({url:IPNC.serverURL+"ini.htm",success:function(g){origDateTimeSettings=d(parseINI(g));dateTimeSettings=$.extend({},origDateTimeSettings);$.ajax({url:IPNC.serverURL+"timezoneinfo.txt",success:function(l){var q=l.replace(/\r\n/,"\n").split(/\n/);var w={timeZones:q.filter(function(i){return i.length>0})};$.extend(origDateTimeSettings,w);$.extend(dateTimeSettings,w);function n(i,z,t){return mkCheckButton(i,z,{checked:origDateTimeSettings[t]===1,disabled:dateTimeSettingsCount!==2,change:function(B){var A=B?1:0;logDebug("changed",t,"to",A,"Originally was",origAudioSettings[t]);dateTimeSettings[t]=A}})}var s=dateTimeSettings.date.split(/\//);var x=dateTimeSettings.time.split(/:/);var m=new Date(s[0],s[1]-1,s[2],x[0],x[1],x[2]);var o=x[2];var k=c(m);var y=mkInlineInput({id:"dateId",value:k.dateFormat()[dateTimeSettings.dateformat],"class":"input-small",label:"Date ",disabled:"disabled"});var p=mkInlineInput({id:"timeId","class":"input-small",label:"Time ",disabled:"disabled"});var v=n("Automaticaly Adjust for daylight saving time","dayTime","daylight");var r=mkControlGroup("Date Format ",[mkInlineSelectionInput(" ","selectDateFormat",dateTimeSettings.dateformats,{selectedIndex:dateTimeSettings.dateformat,selectClass:"input-medium",change:curry(updateFromCombo,dateTimeSettings,"dateformat","selectDateFormat")}),mkInlineSelectionInput("Time Format ","selectTimeFormat",dateTimeSettings.timeformats,{selectedIndex:dateTimeSettings.tstampformat,selectClass:"input-medium",change:curry(updateFromCombo,dateTimeSettings,"tstampformat","selectTimeFormat")})]);var u=mkControlGroup("Date Position ",[mkInlineSelectionInput(" ","selectDatePosition",dateTimeSettings.datetimepositions,{selectedIndex:dateTimeSettings.dateposition,selectClass:"input-medium",change:curry(updateFromCombo,dateTimeSettings,"dateposition","selectDatePosition")}),mkInlineSelectionInput("Time Position ","selectTimePosition",dateTimeSettings.datetimepositions,{selectedIndex:dateTimeSettings.timeposition,selectClass:"input-medium",change:curry(updateFromCombo,dateTimeSettings,"timeposition","selectTimePosition")})]);var j=mkElemClass("div","form-horizontal form-inline",[mkCameraTitle("Camera",{id:"inputCamera",value:dateTimeSettings.title,"class":"input-medium",disabled:"disabled"},"icon-camera","labelDayLight"),mkControlGroup("Time in camera",[y,p]),mkControlGroup("Set Time ",a()),v,r,u]);var h=mkElemClass("div","form-actions",[mkButton("Ok","btn-primary",mkVerboseSaver(saveDateTimeSettings,"Date/Time settings saved to "+dateTimeSettings.title,openDateTime)),mkSpace(),mkButton("Cancel",null,openDateTime)," "]);$("#mainbar").html(mkElem("div",{},[mkElem("h2",{},"Date/Time"),j,mkSaveStatusDiv(),h]));$("#dateManualId").datepicker({format:dateTimeSettings.dateformats[dateTimeSettings.dateformat].toLowerCase(),autoclose:true});adjustSidebarHeight();timerManager.createIntervalTimer(function(){var i=f();$("#timeCompId").val(i.timeFormat());$("#dateCompId").val(i.dateFormat()[dateTimeSettings.dateformat])},1000);timerManager.createIntervalTimer(function(){k.incrementSeconds();$("#timeId").val(k.timeFormat());$("#dateId").val(k.dateFormat()[dateTimeSettings.dateformat])},1000);$("#setManualy").change(function(){dateTimeSettingsCount=0;$("#selectTimeHr").removeAttr("disabled");$("#selectTimeMin").removeAttr("disabled");$("#selectTimeSec").removeAttr("disabled");$("#dateManualId").removeAttr("disabled");$("#selectTimeZone").attr("disabled","disabled");$("#dayTime").attr("disabled","disabled")});$("#syncCompId").change(function(){dateTimeSettingsCount=1;$("#selectTimeHr").attr("disabled","disabled");$("#selectTimeMin").attr("disabled","disabled");$("#selectTimeSec").attr("disabled","disabled");$("#dateManualId").attr("disabled","disabled");$("#selectTimeZone").attr("disabled","disabled");$("#dayTime").attr("disabled","disabled")});$("#syncServId").change(function(){dateTimeSettingsCount=2;$("#selectTimeHr").attr("disabled","disabled");$("#selectTimeMin").attr("disabled","disabled");$("#selectTimeSec").attr("disabled","disabled");$("#dateManualId").attr("disabled","disabled");$("#selectTimeZone").attr("disabled","disabled");$("#selectTimeZone").removeAttr("disabled");$("#dayTime").removeAttr("disabled")});$("#selectDateFormat").change(function(){var i=f();$("#dateManualId").val(i.dateFormat()[dateTimeSettings.dateformat])});validateDatefield("#dateManualId");showPendingStatus();checkDaylight()}})}})}function closeDateTime(a){dateTimeSettingsCount=-1;if(isDifferent(origDateTimeSettings,dateTimeSettings)){showConfirmationModal("Message","Do you want to save the changes?",curry(saveDateTimeSettings,a),a,true)}else{a()}};