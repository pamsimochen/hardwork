function objCountSetDirection(a,b){videoManager.setProperty("zoneArrowAlign",a,b)}function objCountSetAlign(b,a){videoManager.setProperty("zoneAlign",parseDecimal(b),a)}function objCountInitPlugin(d,c,a,e){setOverlayProperties(d,e);var f=(d.dmvaocleftright===1)?0:1;var b=(d.dmvaocdirection===0)?2:((d.dmvaocdirection===2)?0:1);objCountSetAlign(f,e);objCountSetDirection(b,e);videoManager.setProperty("uimode",PLUGIN_UI_MODE.OC,e)}function ocValidate(a){return chainValidatorCopy([{selector:"#objMinHghtId",min:a.dmvatzocminheightlimit,max:a.dmvatzocmaxheightlimit,field:"height",validator:validateMinMax},{selector:"#objMinWdthId",min:a.dmvatzocminwidthlimit,max:a.dmvatzocmaxwidthlimit,field:"width",validator:validateMinMax}])}var oCAdjustChecked=false;function openObjectCounting(){var d={};var c={};function a(){var g=[20,40,c.dmvaocobjectwidth,c.dmvaocobjectheight].join(":");videoManager.setProperty("enableObjt",0,"objectCount");videoManager.setProperty("objSize",g,"objectCount");videoManager.setProperty("objLimits",c.objLimits,"objectCount");videoManager.setProperty("enableObjt",1,"objectCount")}function e(h,i){var g=ocValidate(c);if(g.valid){sendSettings(c,["dmvaocsensitivity","dmvaocobjectheight","dmvaocobjectwidth","dmvaocenable","dmvaocleftright","dmvaoctopbottom","dmvaocdirection"],function(){if(h){sendSettings(c,["dmvaocsave"],curry(delayedExec,i))}else{delayedExec(i)}})}else{showOverlaidMessageModal("Message",g.msg)}}function f(){function h(i,j){return[mkElem("label",{},i),mkInlineCheckButtonElem(" ",j+"ViewChkId",{checked:oCAdjustChecked,change:function(l){if(l){var k=l?1:0;c.dmvaocenable=k;$(j+"ViewChkId").attr("checked",true);a()}else{$(j+"ViewChkId").attr("checked",false);videoManager.setProperty("enableObjt",0,"objectCount")}oCAdjustChecked=l}}),null,[mkInputElem({id:j+"MinWdthId",maxlength:2,"class":"input-micro",value:c.dmvaocobjectwidth,change:curry(updateFromInput,c,"dmvaocobjectwidth",j+"MinWdthId")}),"&nbsp;%"],null,null,[mkInputElem({id:j+"MinHghtId",maxlength:2,"class":"input-micro",value:c.dmvaocobjectheight,change:curry(updateFromInput,c,"dmvaocobjectheight",j+"MinHghtId")}),"&nbsp;%"]]}var g=curry(updateFromCombo,c,"dmvaocsensitivity","selectSensitivityId");return mkElemClass("div","",[mkControlGroup("Sensitivity",mkInlineSelectionInput("","selectSensitivityId",c.ocSensitivities,{selectClass:"input-large",selectedIndex:c.dmvaocsensitivity-1,change:function(){g();c.dmvaocsensitivity=c.dmvaocsensitivity+1}})),mkTable([],[[null,"Adjust",null,"Minimun Width",null,null,"Minimun Height"],h("Object size","obj")],{tableClass:"actionControlTable"})])}function b(){var k=mkElemClass("div","",createTab("tabObjCnt","Object Counting Settings","tabStreamTargetObjCnt",f()));function l(){var t=videoManager.getProperty("objSize","objectCount");var s=t.split(/,/g);var u=s[0].split(/:/g);c.dmvaocobjectwidth=u[2];c.dmvaocobjectheight=u[3];$("#table").html(mkElemClass("div","",createTab("tabObjCnt","Object Counting Settings","tabStreamTargetObjCnt",f())));$("#objViewChkId").attr("checked",true);$("#mainbar .nav-tabs a").tab("show")}var j=mkElem("div",{id:"leftPanel","class":"span7 row-fluid"},[centerWrap(mkElem("div",{id:"videoObjCnt"})),mkElem("div",{id:"table"})]);var r=mkElemClass("div","",[mkControlGroup("Counter Orientation",[mkInlineRadioButtonElem("Left-Right","lrId","counter",{checked:c.dmvaocleftright===1,change:function(s){c.dmvaocleftright=s?1:0;c.dmvaoctopbottom=s?0:1;$("#objViewChkId").attr("checked",false);objCountSetAlign(0,"objectCount")}}),mkBreak(),mkInlineRadioButtonElem("Top-Bottom","tbId","counter",{checked:c.dmvaoctopbottom===1,change:function(s){c.dmvaoctopbottom=s?1:0;c.dmvaocleftright=s?0:1;$("#objViewChkId").attr("checked",false);objCountSetAlign(1,"objectCount")}})]),mkControlGroup("Directionality",[mkInlineRadioButtonElem("Bi-Directional","bidirection1Id","dir",{checked:c.dmvaocdirection===0,change:function(s){c.dmvaocdirection=radioCheckButtonSet(3,0,s);objCountSetDirection(2,"objectCount")}}),mkBreak(),mkInlineRadioButtonElem("Zone 1 to 2","zone1to2Id","dir",{checked:c.dmvaocdirection===2,change:function(s){c.dmvaocdirection=radioCheckButtonSet(3,2,s);objCountSetDirection(0,"objectCount")}}),mkBreak(),mkInlineRadioButtonElem("Zone 2 to 1","zone2to1Id","dir",{checked:c.dmvaocdirection===1,change:function(s){c.dmvaocdirection=radioCheckButtonSet(3,1,s);objCountSetDirection(1,"objectCount")}})])]);var p=mkElem("div",{id:"rightPanel","class":"span5"},[mkElemClass("div","",createTab("tabZoneSettings","Zone Settings","tabStreamTargetZoneSettings",r,mkElemClass("div","pull-right",[mkInlineSelectionInput("Load Settings","selectLoadSettings",c.loadNames,{selectedIndex:c.dmvaocload,selectClass:"input-average"}),mkButton("Load","",curry(loadSelectedSetting,c,"dmvaocload",openObjectCounting))]))),mkBreak(),messageWindowTab("objcnt")]);var o="Object Count settings saved to "+c.title;var h=mkElemClass("div","form-horizontal form-inline row-fluid",[j,p]);var g=mkElemClass("div","form-actions",[mkElem("div",{id:"ocsaveDiv"}),mkButton("Apply Settings"," ",mkVerboseSaver(curry(e,false),o,openObjectCounting))," ",mkButton("Save Settings"," ").click(curry(saveSettingsModal,"oc",curry(ocValidate,c)))," ",mkButton("Return to Event Monitor").click(function(){oCAdjustChecked=false;openSmartAnalytics()})]);$("#sidebar").hide();$("#mainbar").removeClass("span9");$("#mainbar").html(mkElem("div",{},[mkElem("h2",{},"Object Counting"),mkBreak(),h,mkBreak(),mkSaveStatusDiv(),g]));$("#table").html(k);var i=getPluginWidthAndHeight(videoSettings,getMainBarHalfAvailableSpace({x:10,y:10}),1);addVideoDiv(c,"#videoObjCnt",i.width,i.height,"objectCount");$("#mainbar .nav-tabs a").tab("show");$("#ocsaveDiv").html(mkFileNameModal("oc",c,"dmvaocloadnames",saveSettings,mkVerboseSaver(curry(e,true),o,openObjectCounting),"objSettings"));showPendingStatus();validateSettingsFileName("#inputFileNameoc");objCountInitPlugin(c,0,0,"objectCount");videoManager.registerVLCEvent("onObjResized",l);playFirstStream();if(oCAdjustChecked){a()}var q=["#bidirection1Id","#zone1to2Id","#zone2to1Id"];showDirHoverMessages("objcnt",q);var n=["Left-Right: Count objects moving left-right across field of view.","Top-Bottom: Count objects moving top-bottom across field of view.","Modify Object Size: Select this option in order to modify size of objects in the scene."];var m=["Object Width: Use mouse to adjust the expected size of an object in the scene. The width of the bounding box will be shown here as a percentage of the image width.","Object Height: Use mouse to adjust the expected size of an object in the scene. The height of the bounding box will be shown here as a percentage of the image height."];$.each(["#objMinWdthId","#objMinHghtId"],function(s,t){$(t).hover(function(){$("#objcntMessage").text(m[s])});validateNumericField(t)});$.each(["#lrId","#tbId","#objViewChkId"],function(s,t){$(t).hover(function(){$("#objcntMessage").text(n[s])})})}$.ajax({url:IPNC.serverURL+"ini.htm",success:function(g){var h=parseINI(g);videoSettings=initVideoSettings(h);d=$.extend({},h,{ocSensitivities:h.dmvaocsensitivityname.split(/;/),loadNames:parseLoadNames(h.dmvaocloadnames)});c=$.extend({},d);c.objLimits=[[c.dmvatzocminwidthlimit,c.dmvatzocminheightlimit].join(":"),[c.dmvatzocmaxwidthlimit,c.dmvatzocmaxheightlimit].join(":")].join(",");b()}})};