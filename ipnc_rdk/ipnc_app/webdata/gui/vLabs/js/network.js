var orgNetworkSettings={},networkSettings={};function validatePath(c,a){var b=$(a).val();b=""+b;if(b.length===0){return{valid:false,msg:mkElem("p",{},c+" is mandatory field")}}return{valid:true}}function validateEmailSMTPServer(a,e){var d=/[^0-9a-zA-Z_\-.@]/g;function c(){var g=$(a).val();var f=g.replace(d,"");if(g!==f){$(a).val(f)}if(e){e(f)}}function b(f){return keyEventCheck(f,[isASCIIControlKey,isASCIINumKey,isASCIIAlphabetKey,curry(isASCIISpecialKey,[ASCII.UNDERSCORE,ASCII.HYPHEN,ASCII.PERIOD,ASCII.AT])])}registerChangeHandlers($(a),c).keypress(b)}function validateUploadPath(a,e){var c=/[^0-9a-zA-Z_\-.:\/ ]/g;function b(){var g=$(a).val();var f=g.replace(c,"");if(g!==f){$(a).val(f)}if(e){e(f)}}function d(f){return keyEventCheck(f,[isASCIIControlKey,isASCIINumKey,isASCIIAlphabetKey,curry(isASCIISpecialKey,[ASCII.SPACE,ASCII.HYPHEN,ASCII.PERIOD,ASCII.UNDERSCORE,ASCII.SLASH,ASCII.COLON])])}registerChangeHandlers($(a),b).keypress(d)}function validateAccNameField(b,e){var d=/[^0-9a-zA-Z_.@]/g;function c(){var g=$(b).val();var f=g.replace(d,"");if(g!==f){$(b).val(f)}if(e){e(f)}}function a(f){return keyEventCheck(f,[isASCIIControlKey,isASCIINumKey,isASCIIAlphabetKey,curry(isASCIISpecialKey,[ASCII.PERIOD,ASCII.UNDERSCORE,ASCII.AT])])}registerChangeHandlers($(b),c).keypress(a)}function validateSNTPServer(b,e){var d=/[^0-9a-zA-Z_\-.,\/]/g;function c(){var g=$(b).val();var f=g.replace(d,"");if(g!==f){$(b).val(f)}if(e){e(f)}}function a(f){return keyEventCheck(f,[isASCIIControlKey,isASCIINumKey,isASCIIAlphabetKey,curry(isASCIISpecialKey,[ASCII.HYPHEN,ASCII.PERIOD,ASCII.UNDERSCORE,ASCII.SLASH,ASCII.COMMA])])}registerChangeHandlers($(b),c).keypress(a)}function validateSntpServer(c,b){var a=$(b).val();a=""+a;if(a.length===0){$(b).val("0.0.0.0")}return{valid:true}}function validateSmtpFtpPorts(d,a){var b=$(a).val();var c=""+b;if(c.length<1){return{valid:false,msg:[mkElem("p",{},d+" port is a mandatory field")]}}return{valid:true}}function validatePorts(d,a){var b=$(a).val();var c=""+b;if(c.length===0){$(a).val("00");return{valid:true}}else{if(c.length===1){return{valid:false,msg:[mkElem("p",{},"Invalid "+d+" port number")]}}}return{valid:true}}function saveNetworkSettings(b){var a=chainValidator([{fieldName:"FTP Server name",selector:"#FTPserver",validator:ipValidation},{fieldName:"SMTP Server name",selector:"#SMTPserver",validator:validateSmtpIPAddress},{fieldName:"Email",selector:"#mail",validator:validateEmailAddress},{fieldName:"File Upload Path",selector:"#fileUpload",validator:validatePath},{fieldName:"Sender",selector:"#sender",validator:validateEmailAddress},{fieldName:"Username",selector:"#userName",validator:curry(validateUserNamePassword,"FTP")},{fieldName:"Password",selector:"#ftppassword",validator:curry(validateUserNamePassword,"FTP")},{fieldName:"Password",selector:"#password",validator:curry(validateUserNamePassword,"SMTP")},{fieldName:"A/C Name",selector:"#accName",validator:curry(validateUserNamePassword,"SMTP")},{fieldName:"Https",selector:"#httpsPort",validator:validatePorts},{fieldName:"SMTP",selector:"#SMTPport",validator:validateSmtpFtpPorts},{fieldName:"FTP",selector:"#FTPport",validator:validateSmtpFtpPorts},{fieldName:"SNTP",selector:"#sntpServer",validator:validateSntpServer}]);if(a.valid){networkSettings.ftpip=$("#FTPserver").val();networkSettings.httpsport=$("#httpsPort").val();networkSettings.sntpip=$("#sntpServer").val();var c=["ftpip","ftpuser","ftppassword","ftppath","multicast","ftpipport","smtpuser","emailuser","httpport","httpsport","portinput","portoutput","rs485"];if(networkSettings.dhcpenable!==1){c=c.concat(["netip","netmask","gateway","dnsip"])}sendSettings(networkSettings,["smtpip","smtpauth","sntpip","smtppwd","smtpsender","smtpport"],function(){sendSettings(networkSettings,c,function(){checkReload(function(d){if(d){$("#updateModal").modal({backdrop:"static",keyboard:false});new modalProgress(networkSettings.reloadTime,function(){$("#updateModal").modal("hide");setTimeout(b,100)})}else{setTimeout(b,100)}})})})}else{showOverlaidMessageModal("Message",a.msg)}}function openNetWorkAndPort(){function j(o,m,n,q){var p=mkTabbable(o,[{label:m,target:n,content:q}]);return p}function d(n,m,o){return mkControlGroup(n+"Server",[mkInlineInput({id:n+"server","class":"input-medium",maxlength:15,value:networkSettings[m]}),mkInlineInput({id:n+"port","class":"input-micro",label:"Port ",maxlength:4,value:networkSettings[o]})])}function h(){return mkElemClass("div","form-horizontal form-inline",[d("FTP","ftpip","ftpipport"),mkInput({id:"userName","class":"input-medium",label:"User Name",value:networkSettings.ftpuser,maxlength:32,change:curry(updateFromInput,networkSettings,"ftpuser","userName")}),mkInput({id:"ftppassword","class":"input-medium",label:"Password",type:"password",value:networkSettings.ftppassword,maxlength:16,change:curry(updateFromInput,networkSettings,"ftppassword","ftppassword")}),mkInput({id:"fileUpload","class":"input-medium",label:"File Upload",maxlength:50,value:networkSettings.ftppath})])}function a(m,o,n){return mkCheckButton(m,o,{checked:parseDecimal(orgNetworkSettings[n])===1,change:function(q){var p=q?1:0;logDebug("changed",n,"to",p,"Originally was",orgNetworkSettings[n]);networkSettings[n]=p}})}function b(){return mkCheckButtonElem("Enable Multicast","enableMulticast",{checked:orgNetworkSettings.multicast===1,change:function(n){var m=n?1:0;logDebug("changed","multicast","to",m,"Originally was",orgNetworkSettings.multicast);networkSettings.multicast=m}})}function c(){return mkInput({id:"sntpServer","class":"input-medium",label:"SNTP Server",maxlength:30,value:networkSettings.sntpip,change:curry(updateFromInput,networkSettings,"sntpip","sntpServer")})}function f(){var n=mkControlGroup("HTTP Port",[mkInlineInput({id:"httpPort","class":"input-micro",maxlength:4,value:networkSettings.httpport,disabled:"disabled"}),mkInlineInput({id:"httpsPort","class":"input-mini",maxlength:4,label:"HTTPS Port ",value:networkSettings.httpsport})]);var p=mkInlineSelectionInput("Input ","selectInput",networkSettings.portInputsOutputs,{selectedIndex:networkSettings.portinput,selectClass:"input-small",change:curry(updateFromCombo,networkSettings,"portinput","selectInput")});var o=mkInlineSelectionInput("Output ","selectOutput",networkSettings.portInputsOutputs,{selectedIndex:networkSettings.portoutput,selectClass:"input-small",change:curry(updateFromCombo,networkSettings,"portoutput","selectOutput")});var m=mkElem("div",{},[p,o]);return mkElemClass("div","form-horizontal form-inline",[n,mkControlGroup("Input/Output",m),mkSelectionInput("RS486","selectRs485",networkSettings.rs485Vals,{selectedIndex:networkSettings.rs485,selectClass:"input-mini",change:curry(updateFromInput,networkSettings,"smtpuser","accName")})])}function l(n){var m=n.split(/\./);return $.map(m,function(o){return parseDecimal(o)}).join(".")}function k(){if(networkSettings.dhcpenable===1){return"disabled"}else{return false}}function e(){var m=l(networkSettings.netip);var n=l(networkSettings.netmask);var o=l(networkSettings.gateway);var p=l(networkSettings.dnsip);return mkElemClass("div","form-horizontal",[mkInput({id:"inputIpAddr",disabled:k(),value:m,"class":"input-medium",label:"Ip Address",maxlength:15,change:curry(updateFromInput,networkSettings,"netip","inputIpAddr")}),mkInput({id:"netMask",disabled:k(),value:n,"class":"input-medium",label:"Netmask",maxlength:15,change:curry(updateFromInput,networkSettings,"netmask","netMask")}),mkInput({id:"defaultGateWay",disabled:k(),value:o,"class":"input-medium",label:"Default Gateway",maxlength:15,change:curry(updateFromInput,networkSettings,"gateway","defaultGateWay")}),mkInput({id:"primaryName",disabled:k(),value:p,"class":"input-medium",label:"Primary Name",maxlength:15,change:curry(updateFromInput,networkSettings,"dnsip","primaryName")})])}function i(){return mkElemClass("div","form-horizontal form-inline",[mkCheckButtonElem("My Server Requires Authentication","srvrAuth",{checked:orgNetworkSettings.smtpauth===1,change:function(n){var m=n?1:0;logDebug("changed","smtpauth","to",m,"Originally was",orgNetworkSettings.smtpauth);networkSettings.smtpauth=m}}),mkBreak(),mkInput({id:"accName","class":"input-medium",label:"A/C.Name",maxlength:32,value:networkSettings.smtpuser,change:curry(updateFromInput,networkSettings,"smtpuser","accName")}),mkInput({id:"password","class":"input-medium",label:"Password",type:"password",maxlength:16,value:networkSettings.smtppwd,change:curry(updateFromInput,networkSettings,"smtppwd","password")}),mkInput({id:"sender","class":"input-medium",label:"Sender",maxlength:30,value:networkSettings.smtpsender,change:curry(updateFromInput,networkSettings,"smtpsender","sender")}),d("SMTP","smtpip","smtpport"),mkInput({id:"mail","class":"input-medium",label:"Email",maxlength:50,value:networkSettings.emailuser})])}function g(m){return $.extend({},m,{portInputsOutputs:m.portinputname.split(/;/g),rs485Vals:m.rs485name.split(/;/g)})}$.ajax({url:IPNC.serverURL+"ini.htm",success:function(q){orgNetworkSettings=g(parseINI(q));networkSettings=$.extend({},orgNetworkSettings);var o=mkElem("div",{id:"rightPanel","class":"span6"},mkElemClass("div","form-horizontal row-fluid",[mkBreak(),mkBreak(),j("ftpTabGroup","FTP","ftpTab",h()),mkBreak(),j("rtspTabGroup","RTSP","rtspTab",b()),mkBreak(),j("sntpTabGroup","SNTP","sntpTab",c()),j("portTabGroup","Port Setting","portSettingTab",f())]));var n=mkElem("div",{id:"leftPanel","class":"span6"},mkElemClass("div","form-horizontal",[mkCameraTitle("Camera",{id:"inputCamera",value:networkSettings.title,"class":"input-medium",disabled:"disabled"},"icon-camera","labelDayLight"),j("tabnetWorkId","Network","networktabId",e()),mkBreak(),mkBreak(),j("tabsmtpId","SMTP","smtptabId",i())]));var p=mkElemClass("div","row-fluid",[n,o]);var m=mkElemClass("div","form-actions",[mkButton("Ok","btn-primary",mkVerboseSaver(saveNetworkSettings,"Network and Port settings saved to "+networkSettings.title,openNetWorkAndPort))," ",mkButton("Cancel",null,openNetWorkAndPort)," "]);$("#mainbar").html(mkElemClass("div","networkPortScreen",[mkElem("h2",{},"Network And Port"),p,mkSaveStatusDiv(),m]));$("#mainbar .nav-tabs a").tab("show");showPendingStatus();adjustSidebarHeight();validateAlphaNumericField("#userName");validateAccNameField("#accName");validateAlphaNumericField("#password");validateAlphaNumericField("#ftppassword");validateNumericField("#httpsPort",4,curry(updateFromInput,networkSettings,"httpsport","httpsPort"));validateNumericField("#SMTPport",4,curry(updateFromInput,networkSettings,"smtpport","SMTPport"));validateNumericField("#FTPport",4,curry(updateFromInput,networkSettings,"ftpipport","FTPport"));validateIPAddressNumber("#FTPserver",curry(updateFromInput,networkSettings,"ftpip","FTPserver"));validateUploadPath("#fileUpload",curry(updateFromInput,networkSettings,"ftppath","fileUpload"));validateSNTPServer("#sntpServer",curry(updateFromInput,networkSettings,"sntpip","sntpServer"));validateEmailSMTPServer("#SMTPserver",curry(updateFromInput,networkSettings,"smtpip","SMTPserver"));validateEmailSMTPServer("#mail",curry(updateFromInput,networkSettings,"emailuser","mail"));validateEmailSMTPServer("#sender",curry(updateFromInput,networkSettings,"smtpsender","sender"));validateIPAddressNumber("#inputIpAddr",curry(updateFromInput,networkSettings,"ftpip","inputIpAddr"));validateIPAddressNumber("#netMask",curry(updateFromInput,networkSettings,"ftpip","netMask"));validateIPAddressNumber("#defaultGateWay",curry(updateFromInput,networkSettings,"ftpip","defaultGateWay"));validateIPAddressNumber("#primaryName",curry(updateFromInput,networkSettings,"ftpip","primaryName"))}})}function closeNetwork(a){if(isDifferent(orgNetworkSettings,networkSettings)){showConfirmationModal("Message","Do you want to save the changes?",curry(saveNetworkSettings,a),a,true)}else{a()}};