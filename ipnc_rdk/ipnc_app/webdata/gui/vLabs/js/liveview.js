function openLiveView(l){logDebug("Opening live view");var p={},u={};function z(E,D,C){$("iframe").hide();var B=mkModal("waitModal",null,E,"This might take a few moments.","[ Please Wait ]",false);B.modal();$.ajax({url:IPNC.serverURL+D,success:function(G){B.modal("hide");var F=parseVBResponse(G);if(!F.parseErrorsFound){showMessageModal("Message",C,curry(openLiveView,true))}}})}function y(){z("Formatting SD Card","vb.htm?sdformat=1","SD Card Format Successful")}function r(){z("Unmounting SD Card","vb.htm?sdunmount=1","SD Card Unmount Successful")}function n(){z("Mounting SD Card","vb.htm?sdunmount=8","SD Card Mount Successful")}function x(){v();var B=mkButton("Back","buttonBack",function(){$("iframe").get(0).contentWindow.history.back();$(this).hide()}).hide();$("#mainbar").html(mkElem("div",{},[mkElem("h2",{},"SD Card Explorer"),mkElemClass("div","sdcardToolbar",[mkButton("Format","btn-danger",y),t(),u.sdinsert==3?mkButton("Unmount",null,r):mkButton("Mount",null,n)]),mkElem("iframe",{src:IPNC.serverURL+"sdget.htm","class":"ipnc-iframe"}),mkElem("div",{},B)]));$("iframe").load(function(){var C=$(this).contents().find("a");C.click(function(){logDebug("Iframe click");B.show()})})}function e(){timerManager.clear();v();videoManager.hideAll();u.audioenable=u.audioenable===1?0:1;sendSettings(u,["audioenable","audiomode"],function(){checkReload(function(C,B){if(C){$("#updateModal").modal({backdrop:"static",keyboard:false});new modalProgress(B,function(){$("#updateModal").modal("hide");delayedExec(openLiveView)})}else{delayedExec(openLiveView)}})})}function q(B){B.demoConfigNames=B.democfgname.split(/;/);B.streamNames=$.map(range(B.videocodec+1),function(C){return p.getStreamName(C)})}function v(){var C=u.videocodec+1;var B=$("#checkAllStreams").attr("checked");if(B){videoManager.stop("video0");videoManager.stop("video1");if(C>2){videoManager.stop("video2")}}else{videoManager.stop()}}function d(){var C=u.videocodec+1;var B=$("#checkAllStreams").attr("checked");k(C,B)}function i(){var B=$("#videoWrap").offset();return{width:Math.min($("#mainbar").width(),$("body").width()-B.left),height:$(window).height()-B.top-40}}function A(D){logDebug("Playing single stream",D);var B=i();if(B.width<660){B.width=660}if(B.height<380){B.height=380}var C=getPluginWidthAndHeight(u,B,D+1);logDebug("Plugin dimension",C.width,"x",C.height);$("#videoWrap").html(centerWrap(mkElemId("div","videoAnchorLive0")));addVideoDiv(u,"#videoAnchorLive0",C.width,C.height,"video0");videoManager.play(u.getStreamUrl(D))}function k(I,H){if(H){videoManager.stop();$("#videoWrap").html(mkElemClass("div","row-fluid",[mkElemClass("div","span7",[p.streamNames[0],mkElemId("div","videoAnchorLive0")]),mkElemClass("div","span5",[p.streamNames[1],mkElemId("div","videoAnchorLive1"),mkBreak(),I>2?p.streamNames[2]:null,I>2?mkElemId("div","videoAnchorLive2"):null])]));var L=i();if(u.democfg===1){var G=7}else{var G=5}var J=5;var D=12;var E=getPluginWidthAndHeight(u,{width:L.width*(G/D)-10,height:L.height},1);var K={width:L.width*(J/D)-10,height:I>2?L.height/2:L.height};if(E.width<480){E.width=480}if(E.height<272){E.height=272}var C=getPluginWidthAndHeight(u,E,1);if(K.width<336){K.width=336}if(K.height<224){K.height=224}var B=getPluginWidthAndHeight(u,K,2);addVideoDiv(u,"#videoAnchorLive0",C.width,C.height,"video0");addVideoDiv(u,"#videoAnchorLive1",B.width,B.height,"video1");videoManager.play(u.getStreamUrl(0),"video0");videoManager.play(u.getStreamUrl(1),"video1");if(I>2){if(K.width<336){K.width=336}if(K.height<224){K.height=224}var F=getPluginWidthAndHeight(u,K,3);addVideoDiv(u,"#videoAnchorLive2",F.width,F.height,"video2");videoManager.play(u.getStreamUrl(2),"video2")}}else{videoManager.stop("video0");videoManager.stop("video1");if(I>2){videoManager.stop("video2")}A(0)}}var w=false;function j(){w=true;$("#snapshotForm").css("visibility","visible");$("#buttonSnapshot").addClass("btn-warning")}function f(){w=false;$("#snapshotForm").css("visibility","hidden");$("#buttonSnapshot").removeClass("btn-warning")}function c(){if(w){f()}else{j()}}function a(){var B={clicksnapfilename:$("#inputSnapshotName").val(),clicksnapstorage:1};logDebug("Saving snapshot to",B.clicksnapfilename);$.ajax({url:IPNC.serverURL+"vb.htm",data:B,success:function(D){var C=parseVBResponse(D);logInfo("Snapshot save successfully returned",C);f()}})}function h(){$.ajax({url:IPNC.serverURL+"vb.htm?getalarmstatus",success:function(D){var B=parseVBStatusResponse(D);if(B.getalarmstatus){var C=parseInt(B.getalarmstatus,16);if((C&15)!==0){$("#buttonAlarmStatus").addClass("btn-warning")}else{$("#buttonAlarmStatus").removeClass("btn-warning")}if(C>15){$("#buttonRecordingStatus").addClass("btn-warning")}else{$("#buttonRecordingStatus").removeClass("btn-warning")}}}})}function t(){return"&nbsp;"}function b(){v();$("#videoWrap").hide();showConfirmationModal("Message","This will change the configuration to demo modes selected. Do you want to continue?",m,s,true)}function s(){$("#selectExample").get(0).selectedIndex=u.democfg;$("#videoWrap").show();d()}function m(){var B=$("#selectExample").get(0).selectedIndex;logDebug("Swithching to Example num",B);v();sendSettings({democfg:B},["democfg"],function(){checkReload(function(D,C){if(D){$("#updateModal").modal({backdrop:"static",keyboard:false});new modalProgress(C,function(){$("#updateModal").modal("hide");showOverlaidMessageModal("Message","Modified Mode for camera TI_IPNC",curry(delayedExec,openLiveView))})}else{setTimeout(openLiveView,100)}})})}function g(){timerManager.clear();var B=$("#selectStream").get(0).selectedIndex;videoManager.stop();$("#topnavbar").hide();hideSideBar();$("#mainbar").html(mkElem("div",{},[mkElemClass("span","label",p.streamNames[B]),mkElemClass("div","pull-right",mkButton("Close 1x View","btnClose1X",function(){$("#topnavbar").show();showSideBar();openLiveView(l)})),mkBreak(),mkBreak(),mkElemId("div","videoAnchorDMVA1X")]));var D=$(window).height()-$("#videoAnchorDMVA1X").offset().top-20;addVideoDiv(u,"#videoAnchorDMVA1X",$("#mainbar").width()-10,D,"videoDMVA");var C=[u["streamwidth"+(B+1)],u["streamheight"+(B+1)]].join(":");logDebug("resolution is ",C);videoManager.setProperty("streamResolution",C);videoManager.setProperty("uimodeAlt",PLUGIN_UI_MODE.ONEX);videoManager.play(videoSettings.getStreamUrl(B))}var o=false;$.ajax({url:IPNC.serverURL+"ini.htm",success:function(C){p=initVideoSettings(parseINI(C));videoSettings=p;q(p);u=$.extend({},p);if(u.democfg===1){$("#menuSmartAnalytics").show()}else{$("#menuSmartAnalytics").hide()}if(l){x()}else{var H=mkInlineSelectionInput("Select Stream ","selectStream",p.streamNames,{selectClass:"input-average",change:function(M){if(!o){var L=$("#selectStream").get(0).selectedIndex;videoManager.stop();A(L)}}});var B=mkInlineSelectionInput("Example ","selectExample",u.demoConfigNames,{selectClass:"input-average",selectedIndex:u.democfg,change:b});var E=parseDecimal(p.sdinsert)>0;var I=IPNC.userSettings.users[IPNC.userSettings.currUser].authority===IPNC.userSettings.authorityadmin;var K=I||IPNC.userSettings.users[IPNC.userSettings.currUser].authority===IPNC.userSettings.authorityoperator;var J=mkTable([],[[H,mkIconButton("icon-ipnc-1xdisp","1X Display","buttonOneX",g,"rounded-corner"),mkIconButton("icon-ipnc-snap","Snapshot","buttonSnapshot",c,"rounded-corner"),mkIconButton("icon-ipnc-alarm","Alarm Status","buttonAlarmStatus",false,"rounded-corner"),mkIconButton("icon-ipnc-recording","Recording Status","buttonRecordingStatus",false,"rounded-corner"),mkIconButton("icon-ipnc-audio","Toggle Audio","buttonToggleAudio",e,"rounded-corner"),E&&K?mkIconButton("icon-ipnc-sdcard","SD Card Explorer","buttonSDExplorer",x,"rounded-corner"):null,B]],{tableClass:"liveToolbar zero-border"});var F=u.videocodec+1;var G=F>1?mkCheckButtonElem("Display All Streams","checkAllStreams",{change:function(L){k(F,L);o=L;if(L){$("#buttonOneX").hide()}else{$("#buttonOneX").show()}}}):null;var D=mkElem("div",{id:"snapshotForm","class":"form-horizontal form-inline"},[mkControlGroup("Enter File Name",[mkInputElem({id:"inputSnapshotName",maxlength:20,value:"snap"}),t(),mkButton("Ok","btn-primary",a)]),mkControlGroup("Save To",[mkRadioButtonControls("radioSnapshot",["SD/MMC",{label:"USB",disabled:true},{label:"NAND",disabled:true}],{selectedIndex:0,callback:function(L){u.alarmlocalstorage=L}}),t(),mkButton("Cancel",null,f)])]).css("visibility","hidden");showSideBar();$("#mainbar").html(mkElem("div",{id:"subMain"},[mkElem("h2",{},"Live view"),J,mkUpdateModal(),mkElemClass("div","row-fluid",[mkElemClass("div","span4",G),mkElemClass("div","span8",D)]),mkElem("div",{id:"videoWrap"})]));k(F,false);adjustSidebarHeight();validateSnapshotField("#inputSnapshotName");if(u.audioenable===1){$("#buttonToggleAudio").addClass("btn-warning")}timerManager.createSeqIntervalTimer(h,2*1000)}}})};