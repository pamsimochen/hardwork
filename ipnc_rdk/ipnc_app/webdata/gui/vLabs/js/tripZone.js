function setTZDirection(a,b){videoManager.setProperty("zoneArrowAlign",a,b?b:"tzVideo")}function tripZoneInitPlugin(f,e,a,g){function c(){if(f.dmvatzdirection===0){return 3}else{return f.dmvatzdirection}}setOverlayProperties(f,g);setTZDirection(c(),g);videoManager.setProperty("maxZones",2,g);videoManager.setProperty("maxPolyVertices",16,g);var d=2;var b=[];$.each(range(d),function(k){var i=k+1;var j=f["dmvatzzone"+i+"_roi_numsides"];var h=map(range(j),function(m){var l=pad2(m+1);return[parseDecimal(f["dmvatzzone"+i+"_x"+l]),parseDecimal(f["dmvatzzone"+i+"_y"+l])]});b.push(createZone(h,""+i))});videoManager.setProperty("polyArray",b.join(","),g);videoManager.setProperty("uimode",PLUGIN_UI_MODE.TZ,g)}function onZoneCompletedHandler(a,b){a.zoneComplete=b}function tzValidate(a){return chainValidatorCopy([{fieldName:"Vehicle",selector:"#vhclMinHghtId",selector1:"#vhclMaxHghtId",min:a.dmvatzocminheightlimit,max:a.dmvatzocmaxheightlimit,field:"height",validator:validateMinMaxLimit},{fieldName:"Vehicle",selector:"#vhclMinWdthId",selector1:"#vhclMaxWdthId",min:a.dmvatzocminwidthlimit,max:a.dmvatzocmaxwidthlimit,field:"width",validator:validateMinMaxLimit},{fieldName:"People",selector:"#pplMinHghtId",selector1:"#pplMaxHghtId",min:a.dmvatzocminheightlimit,max:a.dmvatzocmaxheightlimit,field:"height",validator:validateMinMaxLimit},{fieldName:"People",selector:"#pplMinWdthId",selector1:"#pplMaxWdthId",min:a.dmvatzocminwidthlimit,max:a.dmvatzocmaxwidthlimit,field:"width",validator:validateMinMaxLimit}])}function openTripZone(){var b={};var l={};var g={zoneComplete:0};var e=["dmvatzzone1_x01","dmvatzzone1_x02","dmvatzzone1_x03","dmvatzzone1_x04","dmvatzzone1_x05","dmvatzzone1_x06","dmvatzzone1_x07","dmvatzzone1_x08","dmvatzzone1_x09","dmvatzzone1_x10","dmvatzzone1_x11","dmvatzzone1_x12","dmvatzzone1_x13","dmvatzzone1_x14","dmvatzzone1_x15","dmvatzzone1_x16","dmvatzzone1_y01","dmvatzzone1_y02","dmvatzzone1_y03","dmvatzzone1_y04","dmvatzzone1_y05","dmvatzzone1_y06","dmvatzzone1_y07","dmvatzzone1_y08","dmvatzzone1_y09","dmvatzzone1_y10","dmvatzzone1_y11","dmvatzzone1_y12","dmvatzzone1_y13","dmvatzzone1_y14","dmvatzzone1_y15","dmvatzzone1_y16"];var j=["dmvatzzone2_x01","dmvatzzone2_x02","dmvatzzone2_x03","dmvatzzone2_x04","dmvatzzone2_x05","dmvatzzone2_x06","dmvatzzone2_x07","dmvatzzone2_x08","dmvatzzone2_x09","dmvatzzone2_x10","dmvatzzone2_x11","dmvatzzone2_x12","dmvatzzone2_x13","dmvatzzone2_x14","dmvatzzone2_x15","dmvatzzone2_x16","dmvatzzone2_y01","dmvatzzone2_y02","dmvatzzone2_y03","dmvatzzone2_y04","dmvatzzone2_y05","dmvatzzone2_y06","dmvatzzone2_y07","dmvatzzone2_y08","dmvatzzone2_y09","dmvatzzone2_y10","dmvatzzone2_y11","dmvatzzone2_y12","dmvatzzone2_y13","dmvatzzone2_y14","dmvatzzone2_y15","dmvatzzone2_y16"];function i(){return videoManager.getProperty("polyArray","tzVideo")}function k(){var n=i();var m=n.split(/,/g);m=m.slice(0,2);$.each(m,function(p,q){var o=q.split(/;/g);g["dmvatzzone"+(p+1)+"_roi_numsides"]=o[0];o=o.slice(2);$.each(o,function(r,s){s=s.split(/:/);g["dmvatzzone"+(p+1)+"_x"+pad2(r+1)]=parseDecimal(s[0]);g["dmvatzzone"+(p+1)+"_y"+pad2(r+1)]=parseDecimal(s[1])})})}function a(){var n=parseDecimal($("#zone1Id").val());var m=parseDecimal($("#zone2Id").val());if(g.zoneComplete===0){$("#zone1Id").attr("checked","checked");$("#zone2Id").removeAttr("checked");videoManager.setProperty("activeZoneNo",1,"tzVideo");return{valid:false,msg:"Please complete zone 1"}}else{if(g.zoneComplete===1){$("#zone2Id").attr("checked","checked");$("#zone1Id").removeAttr("checked");d(2,"zone2Id");return{valid:false,msg:"Please complete zone 2"}}}return{valid:true}}function c(o,p){k();var n=tzValidate(g);if(n.valid){var m=a();if(m.valid){sendSettings(g,e,function(){sendSettings(g,j,function(){sendSettings(g,["dmvatzvehicleminwidth","dmvatzvehicleminheight","dmvatzvehiclemaxwidth","dmvatzvehiclemaxheight","dmvatzpersonminwidth","dmvatzpersonminheight","dmvatzpersonmaxwidth","dmvatzpersonmaxheight","dmvatzsensitivity","dmvatzpresentadjust","dmvatzdirection","dmvatzzone1_roi_numsides","dmvatzzone2_roi_numsides"],function(){if(o){sendSettings(g,["dmvatzsave"],curry(delayedExec,p))}else{delayedExec(p)}})})})}else{showOverlaidMessageModal("Message",m.msg)}}else{showOverlaidMessageModal("Message",n.msg)}}function h(){$("#zone1Id").removeAttr("checked");$("#zone2Id").removeAttr("checked");$("#bidirection1Id").removeAttr("checked");$("#zone1to2Id").removeAttr("checked");$("#zone2to1Id").removeAttr("checked");$("#zone1Id").val(0);$("#zone2Id").val(0);videoManager.setProperty("deleteZone",-1,"tzVideo");$("#zone1Id").attr("checked","checked");uncheckModifyBox("tzVideo");g.zoneComplete=0;d(1,"zone1Id")}function d(m,o){var n=parseInt($("#"+o).val(),10);if(n===0){if(m===2&&parseInt($("#zone1Id").val(),10)!==1){$("#zone2Id").checked=false}else{videoManager.setProperty("addZone","Zone "+m,"tzVideo");$("#"+o).val(1)}}else{videoManager.setProperty("activeZoneNo",m,"tzVideo")}}function f(){b=getPluginWidthAndHeight(videoSettings,getMainBarHalfAvailableSpace({x:10,y:10}),1);var o=["dmvatzvehicleminwidth","dmvatzvehicleminheight","dmvatzvehiclemaxwidth","dmvatzvehiclemaxheight"];var t=["dmvatzpersonminwidth","dmvatzpersonminheight","dmvatzpersonmaxwidth","dmvatzpersonmaxheight","tzSensitivities","dmvatzsensitivity","dmvatzpresentadjust","dmvatzdirection"];var w=mkElemClass("div","",[mkControlGroup("Set Zone",[mkInlineCheckButtonElem("Zone1","zone1Id",{value:1,checked:false,change:function(x){uncheckModifyBox("tzVideo");if(x){$("#zone1Id").attr("checked","checked");$("#zone2Id").removeAttr("checked");d(1,"zone1Id")}else{$("#zone1Id").removeAttr("checked");if($("#zone1Id").val()){videoManager.setProperty("activeZoneNo",0,"tzVideo")}}}}),mkButton("Delete Zones","",h),mkBreak(),mkInlineCheckButtonElem("Zone2","zone2Id",{value:1,checked:false,change:function(x){uncheckModifyBox("tzVideo");if(x){$("#zone2Id").attr("checked","checked");$("#zone1Id").removeAttr("checked");d(2,"zone2Id")}else{$("#zone2Id").removeAttr("checked");if($("#zone2Id").val()){videoManager.setProperty("activeZoneNo",0,"tzVideo")}}}})]),mkControlGroup("Directionality",[mkInlineRadioButtonElem("Bi-Directional","bidirection1Id","dir",{checked:g.dmvatzdirection===0,change:function(x){uncheckModifyBox("tzVideo");g.dmvatzdirection=radioCheckButtonSet(3,0,x);setTZDirection(3)}}),mkBreak(),mkInlineRadioButtonElem("Zone 1 to 2","zone1to2Id","dir",{checked:g.dmvatzdirection===1,change:function(x){uncheckModifyBox("tzVideo");g.dmvatzdirection=radioCheckButtonSet(3,1,x);setTZDirection(1)}}),mkBreak(),mkInlineRadioButtonElem("Zone 2 to 1","zone2to1","dir",{checked:g.dmvatzdirection===2,change:function(x){uncheckModifyBox("tzVideo");g.dmvatzdirection=radioCheckButtonSet(3,2,x);setTZDirection(2)}})])]);var u=mkElem("div",{id:"rightPanel","class":"span5"},[createTab("tabZoneSettings","Zone Settings","tabStreamTargetZoneSettings",w,mkElemClass("div","pull-right",[mkInlineSelectionInput("Load Settings","selectLoadSettings",g.loadNames,{selectedIndex:g.dmvatzload,selectClass:"input-average"}),mkButton("Load","",curry(loadSelectedSetting,g,"dmvatzload",openTripZone))])),mkBreak(),messageWindowTab("tripZone")]);var r=mkElemClass("div","",createTab("tabObj","Trip Zone Settings","tabObjTarget",mkObjectTable(g,t,o,"tzVideo")));var p=mkElem("div",{id:"leftPanel","class":"span7 row-fluid"},[centerWrap(mkElem("div",{id:"tripZoneVideo"})),mkElemId("div","objTable")]);var s="Trip Zone settings saved to "+g.title;var n=mkElemClass("div","form-horizontal form-inline row-fluid",[p,u]);var m=mkElemClass("div","form-actions",[mkElem("div",{id:"tzsaveDiv"}),mkButton("Apply Settings"," ",mkVerboseSaver(curry(c,false),s,openTripZone))," ",mkButton("Save Settings"," ").click(function(){saveSettingsModal("tz",curry(tzValidate,g))})," ",mkButton("Return to Event Monitor").click(openSmartAnalytics)]);$("#sidebar").hide();$("#mainbar").removeClass("span9");$("#mainbar").html(mkElem("div",{},[mkElem("h2",{},"Trip Zone Settings"),mkBreak(),n,mkBreak(),mkSaveStatusDiv(),m]));$("#objTable").html(r);$("#mainbar .nav-tabs a").tab("show");$("#tzsaveDiv").html(mkFileNameModal("tz",g,"dmvatzloadnames",saveSettings,mkVerboseSaver(curry(c,true),s,openTripZone),"tzSettings"));showPendingStatus();addVideoDiv(g,"#tripZoneVideo",b.width,b.height,"tzVideo");tripZoneInitPlugin(g,b.width,b.height,"tzVideo");videoManager.registerVLCEvent("onObjResized",curry(handleObjResize,"Trip Zone Settings",g,"tz",t,o,"tzVideo"));videoManager.registerVLCEvent("onZoneCompleted",curry(onZoneCompletedHandler,g));playFirstStream();validateSettingsFileName("#inputFileNametz");showHoverMsg("tripZone");var v=["Zone 1: Use mouse to draw polygon region for Zone 1. Left click to add a vertex, right click to close polygon.","Zone 2: Use mouse to draw polygon region for Zone 2. Zones 1 and 2 must have one common edge between them. First select the common edge, and then add the additional vertices. Left click to add a vertex, right click to close polygon."];$.each(["#zone1Id","#zone2Id"],function(x,y){$(y).hover(function(){$("#tripZoneMessage").text(v[x])})});var q=["#bidirection1Id","#zone1to2Id","#zone2to1"];showDirHoverMessages("tripZone",q)}$.ajax({url:IPNC.serverURL+"ini.htm",success:function(m){var n=parseINI(m);videoSettings=initVideoSettings(n);l=$.extend({},n,{tzSensitivities:n.dmvatzsensitivityname.split(/;/),loadNames:parseLoadNames(n.dmvatzloadnames)});g=$.extend({},l);g.pplDefaultLimits=[[g.dmvatzocminwidthlimit,g.dmvatzocminheightlimit].join(":"),[g.dmvatzocmaxwidthlimit,g.dmvatzocmaxheightlimit].join(":")].join(",");g.vhclDefaultLimits=g.pplDefaultLimits;g.currScreen="tz";g.checked=0;f()}})};