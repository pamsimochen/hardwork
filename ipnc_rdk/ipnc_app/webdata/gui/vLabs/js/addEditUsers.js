function openAddEditUsers(){var d=16;var g=false;var i={},c={},f={inputAuthority:0};function a(k,m,l){if(k.length>=4&&k.length<=32){if(m.length>=4&&m.length<=16){if(m===l){return{correct:true}}else{return{correct:false,msg:"Password mismatch."}}}else{return{correct:false,msg:"Passwords should have minimum of 4 characters and maximum of 16 characters."}}}else{return{correct:false,msg:"Name should have minimum of 4 characters and maximum of 32 characters."}}}function e(){var k=$("#inputUserName").val(),o=$("#inputPassword").val(),l=$("#inputConfirmPassword").val();function n(){$.ajax({url:IPNC.serverURL+"vb.htm",data:{addUser:[k,o,f.inputAuthority].join(":")},success:function(q){var p=parseVBResponse(q);logDebug("Rcvd response: ",p);if(k===IPNC.userName){setCookies("userName",k);setCookies("passWord",o);IPNC.userPassword=o}if(!p.parseErrorsFound){showMessageModal("Message",["Added user ",mkElemClass("span","label",k)," in the camera."],curry(delayedExec,openAddEditUsers))}}})}logDebug("Authority",f.inputAuthority);var m=a(k,o,l);if(m.correct){if(c.users.length>=d){showMessageModal("Message","Number of users should not exceed 16")}else{if(g||forAll(c.users,function(p,q){return q.name!==k})){n()}else{showConfirmationModal("Message","User already exists. Do you want to replace?",function(){n()},null,true)}}}else{showMessageModal("Message",m.msg)}}function j(l){var k=c.users[l];$("#inputUserName").val(k.name);$("#inputUserName").attr("disabled",k.name===IPNC.userName);$("input[name=radioAuthority]").slice(k.authority,k.authority+1).attr("checked","checked");g=true}function h(m){var k=c.users[m];var l=k.name;showConfirmationModal("Message",["Do you really want to delete user: ",mkElemClass("span","label",l)," ?"],function(){$.ajax({url:IPNC.serverURL+"vb.htm",data:{deluser:k.name},success:function(o){var n=parseVBResponse(o);logDebug("Rcvd response: ",n);if(!n.parseErrorsFound){showMessageModal("Message",["Deleted user ",mkElemClass("span","label",l)," in the camera."],curry(delayedExec,openAddEditUsers))}}})},null,true)}function b(){$("#inputUserName").val("");$("#inputPassword").val("");$("#inputConfirmPassword").val("");$("input[name=radioAuthority]").first().attr("checked","checked");g=false}$.ajax({url:IPNC.serverURL+"ini.htm",username:IPNC.userName,password:IPNC.userPassword,success:function(l){i=initUserSettings(parseINI(l));c=$.extend({},i);var o=mkElemClass("div","form-actions",[mkButton("Ok","btn-primary",e)," ",mkButton("Cancel","",b)]);var k=mkElemClass("div","form-horizontal form-inline offset2",mkElemClass("fieldset","",[mkInput({label:"Username",id:"inputUserName",maxlength:"32"}),mkInput({label:"Password",id:"inputPassword",type:"password",maxlength:"16"}),mkInput({label:"Confirm Password",id:"inputConfirmPassword",type:"password",maxlength:"16"}),mkRadioButtons("Authority","radioAuthority",["Admin","Operator","Viewer"],{selectedIndex:0,callback:function(p){f.inputAuthority=(IPNC.userName===$("#inputUserName").val()?0:p)}}),o]));var m=mkTable(["User Name","Authority","",""],map(c.users,function(q,p){var r=[p.name,c.authorityNames[p.authority]];if(p.name!=="admin"){r.push(mkButton("Edit",null,curry(j,q)));if(p.name!==IPNC.userName){r.push(mkButton("Delete",null,curry(h,q)))}else{r.push("")}}else{r.push("");r.push("")}return r}),{tableClass:"user-table table-striped"});var n=mkElemClass("div","row-fluid",[mkElemClass("div","span2"),mkElem("div",{id:"user-table-container","class":"span8"},m)]);$("#mainbar").html(mkElem("div",{},[mkElem("h2",{},"Add / Edit users"),k,n]));adjustSidebarHeight();$.each(["#inputUserName","#inputPassword","#inputConfirmPassword"],function(p,q){validateAlphaNumericField(q)})}})};