var sMetaConstants={MAX_ZONES:1,MAX_POLY_VERTICES:16,FOV_MSG:"Since no zone has been explicitly defined, an alert event will be signaled when any object motion is detected within the entire field of view. Press Save to accept or Cancel to return to the Streaming Metadat Control Panel.",zoneEnableWorkAround:{dmvasmetazoneenable:1}};function sMetaInitPlugin(d,a,i,f){function g(k,j){var l=k.slice(0);var m=j-k.length;$.each(range(m),function(n,o){l.push([0,0])});return map(l,function(o,n){return n.join(":")}).join(";")}function e(j,k){return[j.length,k,g(j,iMotionConstants.MAX_POLY_VERTICES)].join(";")}setOverlayProperties(d,f);videoManager.setProperty("maxZones",sMetaConstants.MAX_ZONES,f);videoManager.setProperty("maxPolyVertices",sMetaConstants.MAX_POLY_VERTICES,f);var c=d.dmvasmetanumzones;var b=[];$.each(range(c),function(m){var k=m+1;var l=d["dmvasmetazone"+k+"_roi_numsides"];var j=map(range(l),function(o){var n=pad2(o+1);return[parseDecimal(d["dmvasmetazone"+k+"_x"+n]),parseDecimal(d["dmvasmetazone"+k+"_y"+n])]});b.push(e(j,d["dmvasmetazone_"+k+"_label"]))});videoManager.setProperty("polyArray",b.join(","),f);videoManager.setProperty("uimode",PLUGIN_UI_MODE.SM,f);var h=new polyZoneConstructor(d,"smeta",sMetaConstants.MAX_POLY_VERTICES,sMetaConstants.MAX_ZONES,sMetaConstants.FOV_MSG,a,i,PLUGIN_UI_MODE.SM,f);h.updateZoneEnabledStates()}function smetaValidation(a){return chainValidatorCopy([{fieldName:"Vehicle",selector:"#vhclMinHghtId",selector1:"#vhclMaxHghtId",min:a.dmvaimdsmetavehicleminheightlimit,max:a.dmvaimdsmetavehiclemhaxheightlimit,field:"height",validator:validateMinMaxLimit},{fieldName:"Vehicle",selector:"#vhclMinWdthId",selector1:"#vhclMaxWdthId",min:a.dmvaimdsmetavehicleminwidthlimit,max:a.dmvaimdsmetavehiclemaxwidthlimit,field:"width",validator:validateMinMaxLimit},{fieldName:"People",selector:"#pplMinHghtId",selector1:"#pplMaxHghtId",min:a.dmvaimdsmetapersonminheightlimit,max:a.dmvaimdsmetapersonmaxheightlimit,field:"height",validator:validateMinMaxLimit},{fieldName:"People",selector:"#pplMinWdthId",selector1:"#pplMaxWdthId",min:a.dmvaimdsmetapersonminwidthlimit,max:a.dmvaimdsmetapersonmaxwidthlimit,field:"width",validator:validateMinMaxLimit}])}function openStreamMeta(){var b={};var d={};var e={};function a(h,i){var j=["dmvasmetavehicleminwidth","dmvasmetavehicleminheight","dmvasmetavehiclemaxwidth","dmvasmetavehiclemaxheight","dmvasmetapersonminwidth","dmvasmetapersonminheight","dmvasmetapersonmaxwidth","dmvasmetapersonmaxheight","dmvasmetasensitivity","dmvasmetanumzones","dmvasmetaenablestreamingdata"];var g=smetaValidation(e);if(g.valid){sendSettings(e,j,function(){sendXYSettingsForZone(e,"smeta",1,0,function(){sendSettings(e,["dmvasmetapresentadjust","dmvasmetazone1_roi_numsides","dmvasmetazone_1_label"],function(){if(h){sendSettings(e,["dmvasmetasave"],curry(delayedExec,i))}else{delayedExec(i)}})})})}else{showOverlaidMessageModal("Message",g.msg)}}var f;function c(){b=getPluginWidthAndHeight(videoSettings,getMainBarHalfAvailableSpace({x:10,y:10}),1);f=new polyZoneConstructor(e,"smeta",sMetaConstants.MAX_POLY_VERTICES,sMetaConstants.MAX_ZONES,sMetaConstants.FOV_MSG,b.width,b.height,PLUGIN_UI_MODE.SM,"videoSMeta");var k=["dmvasmetavehicleminwidth","dmvasmetavehicleminheight","dmvasmetavehiclemaxwidth","dmvasmetavehiclemaxheight"];var p=["dmvasmetapersonminwidth","dmvasmetapersonminheight","dmvasmetapersonmaxwidth","dmvasmetapersonmaxheight","smetaSensitivities","dmvasmetasensitivity","dmvasmetapresentadjust"];var l=mkElem("div",{id:"leftPanel","class":"span7 row-fluid"},[centerWrap(mkElemId("div","videoAnchorSMeta")),mkElemId("div","objTable",createTab("tabMetaDisp","Metadata Settings Display","tabStreamTargetDisplay",mkObjectTable(e,p,k,"videoSMeta")))]);function n(){$("#streamMetaMessage").text("Add Zone: Click to add a zone or region-of-interest in the image within which you would like to receivestreaming meta-data. By default, the entire image is considered to be a region-of-interest.")}function i(){$("#streamMetaMessage").text("Delete Zone: Click to delete zone.")}function r(x){var v=[];function u(z){var y="dmvasmetazone_"+z+"_label";return[null,mkCheckButtonElem("","zoneEnable"+z,{}),null,null,null,mkElem("lable",{id:"zoneLable"+z},e[y])]}for(var w=0;w<x;w++){v[w]=u(w+1)}return v}var s=[mkButton("Add Zone","",f.addZone).hover(n),"   ","  ",mkButton("Delete Zone","deleteZoneBtn",f.deleteZone).hover(i),mkBreak(),mkElemId("div","zoneTableAnchor")];var h=mkElem("div",{id:"metastreamSettingsLeftId","class":"span5"},[mkCheckButtonElem("Bounding Box","boundingBoxId",{checked:isBitSet(e.dmvasmetaenablestreamingdata,4),change:function(u){e.dmvasmetaenablestreamingdata=changeBitOf(e.dmvasmetaenablestreamingdata,4,u)}}),mkCheckButtonElem("Centroid","centroidId",{checked:isBitSet(e.dmvasmetaenablestreamingdata,2),change:function(u){e.dmvasmetaenablestreamingdata=changeBitOf(e.dmvasmetaenablestreamingdata,2,u)}}),mkCheckButtonElem("Centroid Velocity","centroidVelocityId",{disabled:"disabled"})]);var t=mkElem("div",{id:"metastreamSettingsRightId","class":"span4"},[mkCheckButtonElem("ID","idId",{disabled:"disabled"}),mkCheckButtonElem("Classification","classifiedId",{disabled:"disabled"})]);var m=mkElemClass("div","",[h,t]);var q=mkElem("div",{id:"rightPanel","class":"span5"},[mkElemClass("div","",createTab("tabZoneSettings","Zone Settings","tabStreamTargetZoneSettings",s,mkElemClass("div","pull-right",[mkInlineSelectionInput("Load Settings","selectLoadSettings",e.loadNames,{selectedIndex:e.dmvasmetaload,selectClass:"input-average"}),mkButton("Load","",curry(loadSelectedSetting,e,"dmvasmetaload",openStreamMeta))]))),mkBreak(),createTab("tabMetadataStreamSettings","Metadata Stream Settings","TargetMetaStreamSettings",m),mkBreak(),messageWindowTab("streamMeta")]);var o="Stream metadata  settings saved to "+e.title;var j=mkElemClass("div","form-horizontal form-inline row-fluid",[l,q]);var g=mkElemClass("div","form-actions",[mkElem("div",{id:"smetasaveDiv"}),mkButton("Apply Settings"," ",mkVerboseSaver(function(u){f.checkAndSave(curry(a,false,u))},o,openStreamMeta))," ",mkButton("Save Settings"," ").click(function(){f.checkAndSave(curry(saveSettingsModal,"smeta",curry(smetaValidation,e)))})," ",mkButton("Return to Event Monitor").click(openSmartAnalytics)]);$("#sidebar").hide();$("#mainbar").removeClass("span9");$("#mainbar").html(mkElem("div",{},[mkElem("h2",{},"Streaming Meta"),mkBreak(),j,mkBreak(),mkSaveStatusDiv(),g]));$("#mainbar .nav-tabs a").tab("show");showPendingStatus();$("#smetasaveDiv").html(mkFileNameModal("smeta",e,"dmvasmetaloadnames",saveSettings,mkVerboseSaver(curry(a,true),o,openStreamMeta),"streamingMos"));validateSettingsFileName("#inputFileNamesmeta");showHoverMsg("streamMeta");$("#boundingBoxId").hover(function(){$("#streamMetaMessage").text("Bounding Box: Select to include object bounding boxes in the metadata stream.")});$("#centroidId").hover(function(){$("#streamMetaMessage").text("Centroid: Select to include the object centroid  in the metadata stream.")});addVideoDiv(e,"#videoAnchorSMeta",b.width,b.height,"videoSMeta");playFirstStream();sMetaInitPlugin(e,b.width,b.height,"videoSMeta");videoManager.registerVLCEvent("onZoneCompleted",f.onZoneCompleted);videoManager.registerVLCEvent("onObjResized",curry(handleObjResize,"Metadata Settings Display",e,"smeta",p,k,"videoSMeta"));f.updateZoneTable()}$.ajax({url:IPNC.serverURL+"ini.htm",success:function(g){var h=parseINI(g);videoSettings=initVideoSettings(h);d=$.extend({},sMetaConstants.zoneEnableWorkAround,h,{smetaSensitivities:h.dmvasmetasensitivityname.split(/;/),loadNames:parseLoadNames(h.dmvasmetaloadnames)});e=$.extend({},d);e.pplDefaultLimits=getObjectLimits(e,"imdsmeta","person",true);e.vhclDefaultLimits=getObjectLimits(e,"imdsmeta","vehicle",true);e.currScreen="smeta";c()}})};